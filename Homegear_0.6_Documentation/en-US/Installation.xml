<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Homegear_0.6_Documentation.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Homegear-Homegear_0.6_Documentation-Installation">
	<title>Installation</title>
	<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_System-Requirements">
		<title>System Requirements</title>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_System-Requirements_Hardware-Recommendations">
			<title>Hardware Recommendations</title>
			<para>Homegear runs on pretty much any computer running GNU/Linux. The only requirement is a minimum memory size of 256 MB. Recommended is 1 GB. The memory limits the number of threads that can run simultaneously. Some devices don't need threads and some devices do. So depending on what you want to do, you need more or less memory. 1 GB should be more than enough for all normal installations though.</para>
			<note>
				<para>It is recommended to use a battery backup for your system so there is no data corruption in case of a power blackout.</para>
			</note>
		</section>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_System-Requirements_Software-Requirements">
			<title>Software Requirements</title>
			<para>Homegear should run on all current GNU/Linux distributions. With small changes it can also run on BSD and Mac OS systems.</para>
			<warning>
				<para>Do not run Homegear in a virtual machine as packet timing is very inaccurate.</para>
			</warning>
		</section>
	</section>
	<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository">
		<title>Installing from Repository</title>
		<para>If you are using Debian, Raspbian or Ubuntu you can install Homegear from repository. Please follow the instructions for your system.</para>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian">
			<title>Debian</title>
			<para>Packages are provided for Debian 7 (Wheezy) and Debian 8 (Jessie). Supported architectures are i386, amd64, armel and armhf.</para>
			<warning>
				<para>Don't use the Debian repositories for Raspbian. Use the Raspbian repository instead.</para>
			</warning>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian_Debian-7">
				<title>Debian 7 (Wheezy)</title>
				<para>Please run the following commands as root:</para>
				<programlisting language="Bash">wget https://homegear.eu/packages/Release.key &amp;&amp; apt-key add Release.key &amp;&amp; rm Release.key
echo 'deb https://homegear.eu/packages/Debian/ wheezy/' >> /etc/apt/sources.list.d/homegear.list 
apt-get update
apt-get install homegear</programlisting>
				<para>After installing Homegear, install any family modules you like. To install all family modules available, run:</para>
				<programlisting language="Bash">apt-get install homegear-homematicbidcos homegear-homematicwired homegear-insteon homegear-max homegear-philipshue homegear-sonos</programlisting>
			</section>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian_Debian-8">
				<title>Debian 8 (Jessie)</title>
				<para>Please run the following commands as root:</para>
				<programlisting language="Bash">wget https://homegear.eu/packages/Release.key &amp;&amp; apt-key add Release.key &amp;&amp; rm Release.key
echo 'deb https://homegear.eu/packages/Debian/ jessie/' >> /etc/apt/sources.list.d/homegear.list 
apt-get update
apt-get install homegear</programlisting>
				<para>After installing Homegear, install any family modules you like. To install all family modules available, run:</para>
				<programlisting language="Bash">apt-get install homegear-homematicbidcos homegear-homematicwired homegear-insteon homegear-max homegear-philipshue homegear-sonos</programlisting>
			</section>
		</section>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Raspbian">
			<title>Raspbian</title>
			<para>Packages are provided for Raspbian 7 (Wheezy) and Raspbian 8 (Jessie).</para>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian_Raspbian-7">
				<title>Raspbian 7 (Wheezy)</title>
				<para>Please run the following commands as root:</para>
				<programlisting language="Bash">wget https://homegear.eu/packages/Release.key &amp;&amp; apt-key add Release.key &amp;&amp; rm Release.key
echo 'deb https://homegear.eu/packages/Raspbian/ wheezy/' >> /etc/apt/sources.list.d/homegear.list 
apt-get update
apt-get install homegear</programlisting>
				<para>After installing Homegear, install any family modules you like. To install all family modules available, run:</para>
				<programlisting language="Bash">apt-get install homegear-homematicbidcos homegear-homematicwired homegear-insteon homegear-max homegear-philipshue homegear-sonos</programlisting>
			</section>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian_Raspbian-8">
				<title>Raspbian 8 (Jessie)</title>
				<para>Please run the following commands as root:</para>
				<programlisting language="Bash">wget https://homegear.eu/packages/Release.key &amp;&amp; apt-key add Release.key &amp;&amp; rm Release.key
echo 'deb https://homegear.eu/packages/Raspbian/ jessie/' >> /etc/apt/sources.list.d/homegear.list 
apt-get update
apt-get install homegear</programlisting>
				<para>After installing Homegear, install any family modules you like. To install all family modules available, run:</para>
				<programlisting language="Bash">apt-get install homegear-homematicbidcos homegear-homematicwired homegear-insteon homegear-max homegear-philipshue homegear-sonos</programlisting>
			</section>
		</section>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Ubuntu">
			<title>Ubuntu</title>
			<para>Packages are provided for Ubuntu 14.04 (Trusty Tahr) and Ubuntu 15.10 (Wily Werewolf).</para>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian_Ubuntu-14-04">
				<title>Ubuntu 14.04 (Trusty Tahr)</title>
				<para>Please run the following commands as root:</para>
				<programlisting language="Bash">wget https://homegear.eu/packages/Release.key &amp;&amp; apt-key add Release.key &amp;&amp; rm Release.key
echo 'deb https://homegear.eu/packages/Ubuntu/ trusty/' >> /etc/apt/sources.list.d/homegear.list 
apt-get update
apt-get install homegear</programlisting>
				<para>After installing Homegear, install any family modules you like. To install all family modules available, run:</para>
				<programlisting language="Bash">apt-get install homegear-homematicbidcos homegear-homematicwired homegear-insteon homegear-max homegear-philipshue homegear-sonos</programlisting>
			</section>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Installation_Installing-from-Repository_Debian_Ubuntu-15-10">
				<title>Ubuntu 15.10 (Wily Werewolf)</title>
				<para>Please run the following commands as root:</para>
				<programlisting language="Bash">wget https://homegear.eu/packages/Release.key &amp;&amp; apt-key add Release.key &amp;&amp; rm Release.key
echo 'deb https://homegear.eu/packages/Ubuntu/ wily/' >> /etc/apt/sources.list.d/homegear.list 
apt-get update
apt-get install homegear</programlisting>
				<para>After installing Homegear, install any family modules you like. To install all family modules available, run:</para>
				<programlisting language="Bash">apt-get install homegear-homematicbidcos homegear-homematicwired homegear-insteon homegear-max homegear-philipshue homegear-sonos</programlisting>
			</section>
		</section>
	</section>
	<section id="sect-Homegear-Homegear_0.6_Documentation-Manually_Install_Debian_Raspbian_Ubuntu_Package">
		<title>Manually Install Debian/Raspbian/Ubuntu Package</title>
		<para>Download the correct packages from the <ulink url="https://www.homegear.eu/index.php/Downloads">Homegear download page</ulink>. You need at least the packages "libhomegear-base" and "homegear". Additionally download all family module packages you want to use. Then as root install the packages using dpkg:</para>
		<programlisting language="Bash">dpkg -i libhomegear-base_XXX.deb
dpkg -i homegear_XXX.deb
dpkg -i homegear-MODULENAME_XXX.deb</programlisting>
	</section>
	<section id="sect-Homegear-Homegear_0.6_Documentation-Raspbian-Image">
		<title>Raspbian Image</title>
		<para>If you want to use Homegear on a Raspberry Pi, the easiest way is to <ulink url="https://www.homegear.eu/index.php/Downloads">download the Raspberry Pi image</ulink> and write it to a SD card.</para>
		<para>Follow the instructions on <ulink url="http://elinux.org/RPi_Easy_SD_Card_Setup#Flashing_the_SD_Card_using_Windows">http://elinux.org/RPi_Easy_SD_Card_Setup#Flashing_the_SD_Card_using_Windows</ulink> (for Windows, Mac and GNU/Linux) to get the image onto your SD card.</para>
		<para>Username is: "pi" Password is: "raspberry"</para>
		<para>SSH is enabled on port 22, so you can use a SSH client (e. g. PuTTY) to login and you don't need to connect a display and keyboard. You can try logging in using the hostname "homegearpi" or you need to look the IP address up in your DHCP server (or router).
When you first login, the Raspberry Pi configuration tool will start.</para>
	</section>
	<section id="sect-Homegear-Homegear_0.6_Documentation-Compiling-from-Source">
		<title>Compiling from Source</title>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Compiling-from-Source_Docker">
			<title>Compiling Current GitHub Source Using Docker Image</title>
			<para>The easiest way to compile Homegear from source is by using Docker. Docker images are provided for Debian 7 (Wheezy; amd64, i386, armhf, armel), Debian 8 (Jessie; amd64, i386, armhf, arm64, armel), Raspbian Wheezy, Raspbian Jessie, Ubuntu 14.04 (Trusty Tahr; amd64, i386, armhf, arm64) and Ubuntu 15.10 (Wily Werewolf; amd64, i386, armhf, arm64). Start the Docker image by running:</para>
			<programlisting language="Bash">docker run -it -e HOMEGEARBUILD_SHELL=1 homegear/build:TAG</programlisting>
			<para>Replace "TAG" with one of the tags from <ulink url="https://hub.docker.com/r/homegear/build/tags/">the repository</ulink> (e. g. debian-jessie-amd64). The environment variable needs to be set to avoid being asked for information about a server to upload the created packages to. To speed up compilation you can also set "HOMEGEARBUILD_THREADS" to the number of CPU cores of your system to speed up compilation.</para>
			<para>In the container execute:</para>
			<programlisting language="Bash">/build/CreateDebianPackageNightly.sh</programlisting>
			<para>When done, you can find the created Debian packages in the directory /build.</para>
		</section>
		<section id="sect-Homegear-Homegear_0.6_Documentation-Compiling-from-Source_Manual">
			<title>Manually Compiling Homegear</title>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Compiling-from-Source_Manual_PHP">
				<title>Compiling PHP</title>
				<para>For all systems Homegear is available as Debian package you can get the needed PHP library and header files by installing "php7-homegear-dev" using apt:</para>
				<programlisting language="Bash">apt-get install php7-homegear-dev</programlisting>
				<para>For all other systems you need to compile PHP 7 from source.</para>
				<para>First of all download the PHP source code from the <ulink url="http://php.net/downloads.php">PHP download page</ulink>. Then extract the package:</para>
				<programlisting language="Bash">tar -zxf php-7.X.X.tar.gz</programlisting>
				<para>or</para>
				<programlisting language="Bash">tar -jxf php-7.X.X.tar.bz2</programlisting>
				<para>Change into the subdirectory "ext" within the extracted directory:</para>
				<programlisting language="Bash">cd php-7.X.X/ext</programlisting>
				<para>Download the current version of pthreads from <ulink url="https://github.com/krakjoe/pthreads/releases">GitHub</ulink>, extract it and rename the extracted folder into "pthreads":</para>
				<programlisting language="Bash">wget https://github.com/krakjoe/pthreads/archive/vX.X.X.tar.gz
tar -zxf vX.X.X.tar.gz
rm vX.X.X.tar.gz
mv pthreads-X.X.X pthreads</programlisting>
				<para>We need to allow pthreads to be loaded in Homegear:</para>
				<programlisting language="Bash">sed -i 's/{ZEND_STRL("cli")}/{ZEND_STRL("homegear")}/g' pthreads/php_pthreads.c</programlisting>
				<para>Change into the parent directory and execute autoconf:</para>
				<programlisting language="Bash">cd ..
autoconf</programlisting>
				<para>To fix a bug in the configure script run:</para>
				<programlisting language="Bash">sed -i 's/enableval=$enable_embed;/enableval=static;/g' configure</programlisting>
				<para>Execute the configure script. The lines before the script are needed to get the target system:</para>
				<programlisting language="Bash">target="$(gcc -v 2>&amp;1)"
strpos="${target%%--target=*}"
strpos=${#strpos}
target=${target:strpos}
target=$(echo $target | cut -d "=" -f 2 | cut -d " " -f 1)
./configure  --prefix /usr/share/homegear/php --enable-embed=static --with-config-file-path=/etc/homegear --with-config-file-scan-dir=/etc/homegear/php.conf.d --includedir=/usr/include/php7-homegear --libdir=/usr/share/homegear/php --libexecdir=${prefix}/lib --datadir=${prefix}/share --program-suffix=-homegear --sysconfdir=/etc/homegear --localstatedir=/var --mandir=${prefix}/man --disable-debug --disable-rpath --with-pic --with-layout=GNU --enable-bcmath --enable-calendar --enable-ctype --enable-dba --without-gdbm --with-qdbm=/usr/include/qdbm --enable-inifile --enable-flatfile --enable-dom --with-enchant=/usr --enable-exif --with-gettext=/usr --with-gmp=/usr/include/$target --enable-fileinfo --enable-filter --enable-ftp --enable-hash --enable-json --enable-pdo --enable-mbregex --enable-mbregex-backtrack --enable-mbstring --disable-opcache --enable-phar --enable-posix --with-mcrypt --enable-mysqlnd --enable-mysqlnd-compression-support --with-zlib-dir=/usr --with-openssl --with-libedit=/usr --enable-libxml --enable-session --enable-simplexml --enable-pthreads --with-xmlrpc --enable-soap --enable-sockets --enable-tokenizer --enable-xml --enable-xmlreader --enable-xmlwriter --with-mhash=yes --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-zip --enable-embed --disable-cli --disable-cgi --enable-pcntl --enable-maintainer-zts</programlisting>
				<para>If dependencies are missing, install them and run the configure script again until it finishes successfully. When done, run:</para>
				<programlisting language="Bash">make &amp;&amp; make install</programlisting>
			</section>
			<section id="sect-Homegear-Homegear_0.6_Documentation-Compiling-from-Source_Manual_Homegear">
				<title>Compiling Homegear</title>
				<para>First install all dependencies:</para>
				<itemizedlist spacing="compact">
					<listitem><para>SQLite 3 devel (Debian package libsqlite3-dev)</para></listitem>
					<listitem><para>Readline 6 devel  (Debian package libreadline6-dev)</para></listitem>
					<listitem><para>Libgpg-error devel (Debian package libgpg-error-dev)</para></listitem>
					<listitem><para>GnuTLS devel (Debian package libgnutls28-dev)</para></listitem>
				</itemizedlist>
				<para>Then download Homegear's base library and extract it:</para>
				<programlisting language="Bash">wget https://github.com/Homegear/libhomegear-base/archive/master.zip
unzip master.zip
rm master.zip</programlisting>
				<para>Change into the extracted directory and run "makeRelease.sh" or "makeDebug.sh". You can pass the number of build threads to the script to speed up compilation:</para>
				<programlisting language="Bash">cd libhomegear-base-master
./makeRelease.sh 4</programlisting>
				<para>The same for Homegear:</para>
				<programlisting language="Bash">wget https://github.com/Homegear/Homegear/archive/master.zip
unzip master.zip
rm master.zip
cd Homegear-master
./makeRelease.sh 4</programlisting>
				<para>Repeat these steps for all family modules you want to compile.</para>
			</section>
		</section>
	</section>
</chapter>

